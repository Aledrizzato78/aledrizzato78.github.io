<!-- INÍCIO DO AJUSTE -->
<!-- Alterações: quebra de linha nas mensagens do bot, envio com tecla Enter, janela maior, e dash de acessos -->

<!-- Adiciona isso ao <style> -->
.chatbot-window {
  position: fixed;
  bottom: 110px;
  right: 30px;
  width: 400px; /* Aumenta a largura */
  height: 500px; /* Aumenta a altura */
  background: #1e1e1e;
  border-radius: 10px;
  display: none;
  flex-direction: column;
  z-index: 997;
}

.chatbot-messages {
  height: 100%;
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: .5rem;
  overflow-y: auto;
  white-space: pre-line; /* Para preservar as quebras de linha */
}

/* Dash simples */
#dash {
  position: fixed;
  bottom: 110px;
  left: 30px;
  width: 220px;
  background: rgba(0,0,0,0.6);
  color: white;
  padding: 1rem;
  border-radius: 10px;
  font-size: .9rem;
  z-index: 996;
}

<!-- Coloque logo antes do </body> -->
<div id="dash">
  👀 Acessos: <span id="visitas">0</span><br>
  💬 Interações: <span id="interacoes">0</span>
</div>

<!-- Ajuste o script no final da página -->
<script>
  const chat = document.getElementById("chatbot");
  const messages = document.getElementById("chat-messages");
  const visitasSpan = document.getElementById("visitas");
  const interacoesSpan = document.getElementById("interacoes");
  let interacoes = 0;

  function toggleChatbot() {
    chat.style.display = chat.style.display === "flex" ? "none" : "flex";
  }

  function enviarMensagem() {
    const input = document.getElementById("user-input");
    const texto = input.value.trim();
    if (!texto) return;
    messages.innerHTML += `<div class='user-message'>Você: ${texto}</div>`;
    input.value = "";
    interacoes++;
    interacoesSpan.textContent = interacoes;
    fetch(`${window.BACKEND_URL}/chat/`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ mensagem: texto })
    })
    .then(res => res.json())
    .then(data => {
      messages.innerHTML += `<div class='bot-message'>Bot: ${data.resposta}</div>`;
      messages.scrollTop = messages.scrollHeight;
    })
    .catch(() => {
      messages.innerHTML += `<div class='bot-message'>Erro: não consegui conectar 😢</div>`;
    });
  }

  // Captura Enter para enviar mensagem
  document.getElementById("user-input").addEventListener("keypress", function(e) {
    if (e.key === "Enter") {
      e.preventDefault();
      enviarMensagem();
    }
  });

  // Incrementa acesso ao abrir
  window.addEventListener("load", () => {
    let visitas = localStorage.getItem("visitas") || 0;
    visitas++;
    localStorage.setItem("visitas", visitas);
    visitasSpan.textContent = visitas;
  });
</script>
